<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Detektor Objek Jalan Raya</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat TensorFlow.js Core & Backend -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core@3.9.0/dist/tf-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl@3.9.0/dist/tf-backend-webgl.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-cpu@3.9.0/dist/tf-backend-cpu.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter@3.9.0/dist/tf-converter.min.js"></script>
    <!-- Memuat Library untuk Deteksi Objek (COCO-SSD) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>

    <style>
        .relative-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: auto;
            background-color: #e5e7eb; /* bg-gray-200 */
        }
        #webcam, #image-preview {
            width: 100%;
            height: auto;
            border-radius: 0.5rem;
        }
        #canvas-webcam, #canvas-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .tab-button.active {
            background-color: #3b82f6; /* bg-blue-600 */
            color: white;
        }
        .table-container {
            overflow-x: auto;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col items-center justify-center min-h-screen p-4 font-sans">

    <div class="w-full max-w-2xl bg-white p-6 rounded-lg shadow-lg text-center">
        <h1 class="text-2xl md:text-3xl font-bold mb-2">Detektor Objek Jalan Raya</h1>
        <p class="text-gray-600 mb-4">Bandingkan Akurasi Model Deteksi vs Gemini AI</p>
        
        <div class="mb-4 p-3 bg-yellow-100 border border-yellow-300 rounded-lg">
             <div class="flex items-center justify-center mb-1">
                 <label for="api-key-input" class="block text-sm font-medium text-gray-700">Gemini API Key (Wajib untuk Analisis AI):</label>
                 <button id="api-help-button" class="ml-2 text-blue-500 hover:text-blue-700">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
                 </button>
             </div>
             <input type="password" id="api-key-input" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" placeholder="Masukkan API Key Anda di sini">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
                <label for="model-selector" class="flex items-center justify-center text-sm font-medium text-gray-700 mb-1">
                    Pilih Model COCO-SSD:
                    <button id="model-help-button" class="ml-2 text-blue-500 hover:text-blue-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
                    </button>
                </label>
                <select id="model-selector" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    <option value="coco_ssd_lite">COCO-SSD Lite (Cepat)</option>
                    <option value="coco_ssd_full">COCO-SSD Full (Akurat)</option>
                </select>
            </div>
            <div>
                <label for="threshold-input" class="flex items-center justify-center text-sm font-medium text-gray-700 mb-1">
                    Ambang Batas Kepercayaan:
                    <button id="threshold-help-button" class="ml-2 text-blue-500 hover:text-blue-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
                    </button>
                </label>
                <input type="number" id="threshold-input" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" value="0.4" min="0.1" max="0.9" step="0.1">
            </div>
        </div>

        <div class="flex justify-center border-b mb-4">
            <button id="tab-webcam" class="tab-button py-2 px-4 -mb-px font-semibold text-gray-600 border-b-2 border-transparent rounded-t-lg hover:text-blue-500 active">Deteksi via Webcam</button>
            <button id="tab-upload" class="tab-button py-2 px-4 -mb-px font-semibold text-gray-600 border-b-2 border-transparent rounded-t-lg hover:text-blue-500">Deteksi via Upload</button>
        </div>

        <div id="webcam-section">
            <p id="webcam-summary" class="mb-2 text-gray-600 h-6"></p>
            <div class="relative-container rounded-lg overflow-hidden mb-4">
                <video id="webcam" autoplay playsinline muted></video>
                <canvas id="canvas-webcam"></canvas>
            </div>
            <div class="flex justify-center space-x-4">
                <button id="start-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg" disabled>Mulai Deteksi</button>
                <button id="switch-camera-button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hidden">Ganti Kamera</button>
            </div>
        </div>

        <div id="upload-section" class="hidden">
            <div class="relative-container rounded-lg overflow-hidden mb-4">
                <img id="image-preview" class="hidden" alt="Pratinjau Gambar"/>
                <canvas id="canvas-image"></canvas>
            </div>
            <input type="file" id="image-uploader" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0"/>
            <div class="flex justify-center space-x-2 mt-4">
                <button id="predict-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg" disabled>1. Deteksi</button>
                <button id="gemini-button" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg">2. Analisis AI</button>
            </div>
        </div>
        
        <p id="status" class="mt-2 text-sm text-gray-500">Status: Memuat model...</p>

        <div class="mt-6 w-full">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-lg text-left">Tabel Perbandingan Akurasi</h3>
                <button id="reset-button" class="bg-red-500 hover:bg-red-600 text-white text-xs font-bold py-1 px-3 rounded-lg">Reset</button>
            </div>
            <div id="summary-container" class="table-container bg-gray-50 p-3 rounded-lg"></div>
        </div>
    </div>

    <!-- Modal Pop-up -->
    <div id="api-help-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg text-left"><div class="flex justify-between items-center border-b pb-3 mb-3"><h3 class="text-xl font-bold">Cara Mendapatkan Gemini API Key Gratis</h3><button class="close-modal-button text-gray-500 hover:text-gray-800 text-3xl">&times;</button></div><ol class="list-decimal list-inside space-y-2"><li>Kunjungi situs <a href="https://aistudio.google.com/" target="_blank" class="text-blue-600 hover:underline">Google AI Studio</a>.</li><li>Login dengan akun Google Anda.</li><li>Klik tombol <strong class="font-bold">"Get API key"</strong>.</li><li>Pilih <strong class="font-bold">"Create API key in new project"</strong>.</li><li>Salin API key yang muncul.</li><li>Tempel API key tersebut ke kolom di aplikasi ini.</li></ol></div>
    </div>
    <div id="model-help-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg text-left"><div class="flex justify-between items-center border-b pb-3 mb-3"><h3 class="text-xl font-bold">Penjelasan Model Deteksi</h3><button class="close-modal-button text-gray-500 hover:text-gray-800 text-3xl">&times;</button></div><div class="space-y-4"><div><h4 class="font-bold">COCO-SSD Lite</h4><p>Sangat cepat dan ringan, ideal untuk deteksi video real-time. Akurasinya standar.</p></div><div><h4 class="font-bold">COCO-SSD Full</h4><p>Lebih lambat, tetapi lebih akurat. Mampu mendeteksi objek dengan lebih baik.</p></div></div></div>
    </div>
    <div id="threshold-help-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg text-left"><div class="flex justify-between items-center border-b pb-3 mb-3"><h3 class="text-xl font-bold">Ambang Batas Kepercayaan</h3><button class="close-modal-button text-gray-500 hover:text-gray-800 text-3xl">&times;</button></div><div class="space-y-2"><p>Tingkat keyakinan minimum (0.1 - 0.9) yang harus dimiliki model sebelum melaporkan sebuah objek.</p><ul class="list-disc list-inside space-y-1"><li><strong class="font-semibold">Nilai Rendah (misal: 0.2):</strong> Mendeteksi lebih banyak objek, tetapi mungkin ada yang salah.</li><li><strong class="font-semibold">Nilai Tinggi (misal: 0.8):</strong> Deteksi sangat akurat, tetapi mungkin melewatkan objek yang kurang jelas.</li></ul></div></div>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            // Elemen HTML
            const video = document.getElementById('webcam'), imagePreview = document.getElementById('image-preview'),
                  canvasWebcam = document.getElementById('canvas-webcam'), canvasImage = document.getElementById('canvas-image'),
                  startButton = document.getElementById('start-button'), switchCameraButton = document.getElementById('switch-camera-button'),
                  predictButton = document.getElementById('predict-button'), geminiButton = document.getElementById('gemini-button'),
                  imageUploader = document.getElementById('image-uploader'), statusText = document.getElementById('status'),
                  tabWebcam = document.getElementById('tab-webcam'), tabUpload = document.getElementById('tab-upload'),
                  webcamSection = document.getElementById('webcam-section'), uploadSection = document.getElementById('upload-section'),
                  summaryContainer = document.getElementById('summary-container'), thresholdInput = document.getElementById('threshold-input'),
                  modelSelector = document.getElementById('model-selector'), resetButton = document.getElementById('reset-button'),
                  apiKeyInput = document.getElementById('api-key-input'), apiHelpButton = document.getElementById('api-help-button'),
                  modelHelpButton = document.getElementById('model-help-button'), thresholdHelpButton = document.getElementById('threshold-help-button'),
                  apiHelpModal = document.getElementById('api-help-modal'), modelHelpModal = document.getElementById('model-help-modal'),
                  thresholdHelpModal = document.getElementById('threshold-help-modal'), closeButtons = document.querySelectorAll('.close-modal-button'),
                  webcamSummary = document.getElementById('webcam-summary');

            const ctxWebcam = canvasWebcam.getContext('2d'), ctxImage = canvasImage.getContext('2d');
            
            // State
            let model = undefined, currentModelName = '', currentFacingMode = 'user', videoStream, comparisonResults = [];

            const TARGET_CLASSES = {'person':'Orang','bicycle':'Sepeda','motorcycle':'Motor','car':'Mobil','bus':'Bus','truck':'Truk'};
            const CLASS_COLORS = {'person':'#FBBF24','bicycle':'#34D399','motorcycle':'#F87171','car':'#60A5FA','bus':'#A78BFA','truck':'#F472B6'};

            function drawPredictions(predictions, canvasContext, canvasElement) {
                canvasContext.clearRect(0, 0, canvasElement.width, canvasElement.height);
                if (!predictions) return;

                predictions.forEach(p => {
                    const detectedClass = p.class;
                    if (TARGET_CLASSES[detectedClass]) {
                        const bbox = p.bbox;
                        const score = p.score;
                        const label = TARGET_CLASSES[detectedClass];
                        const color = CLASS_COLORS[detectedClass];
                        canvasContext.strokeStyle = color;
                        canvasContext.lineWidth = 4;
                        canvasContext.fillStyle = color;
                        canvasContext.font = '16px sans-serif';
                        canvasContext.beginPath();
                        canvasContext.rect(...bbox);
                        canvasContext.stroke();
                        const labelText = `${label}: ${Math.round(score * 100)}%`;
                        canvasContext.fillText(labelText, bbox[0], bbox[1] > 20 ? bbox[1] - 5 : 20);
                    }
                });
            }

            function updateComparisonTable() {
                if (comparisonResults.length === 0) {
                    summaryContainer.innerHTML = '<p class="text-center text-gray-500">Jalankan deteksi untuk melihat perbandingan.</p>';
                    return;
                }
                const geminiResult = comparisonResults.find(r => r.modelName === 'Gemini');
                let tableHTML = '<table class="w-full text-left whitespace-nowrap"><thead><tr class="border-b"><th class="py-2 px-2 font-bold">Objek</th>';
                comparisonResults.forEach(result => {
                    let modelNameDisplay;
                    if (result.modelName === 'Gemini') modelNameDisplay = 'Acuan AI';
                    else if (result.modelName.includes('coco_ssd_lite')) modelNameDisplay = `Lite (Th: ${result.threshold})`;
                    else if (result.modelName.includes('coco_ssd_full')) modelNameDisplay = `Full (Th: ${result.threshold})`;
                    tableHTML += `<th class="py-2 px-2 font-bold text-center">${modelNameDisplay}</th>`;
                });
                tableHTML += '</tr></thead><tbody>';
                for (const classKey in TARGET_CLASSES) {
                    const className = TARGET_CLASSES[classKey];
                    tableHTML += `<tr class="border-b border-gray-200"><td class="py-2 px-2 font-medium">${className}</td>`;
                    comparisonResults.forEach(result => {
                        const count = result.counts[classKey] || 0;
                        tableHTML += `<td class="py-2 px-2 text-center">${count}</td>`;
                    });
                    tableHTML += '</tr>';
                }
                if (geminiResult) {
                    tableHTML += `<tr class="bg-gray-200 font-bold"><td class="py-2 px-2">Skor Akurasi</td>`;
                    comparisonResults.forEach(result => {
                        let accuracyScore = '-';
                        if (result.modelName !== 'Gemini') {
                            let totalCorrect = 0, totalGemini = 0;
                            for (const classKey in TARGET_CLASSES) {
                                totalCorrect += Math.min(result.counts[classKey] || 0, geminiResult.counts[classKey] || 0);
                                totalGemini += geminiResult.counts[classKey] || 0;
                            }
                            const score = totalGemini > 0 ? (totalCorrect / totalGemini) * 100 : 100;
                            accuracyScore = `${Math.round(score)}%`;
                        }
                        tableHTML += `<td class="py-2 px-2 text-center">${accuracyScore}</td>`;
                    });
                    tableHTML += '</tr>';
                }
                tableHTML += '</tbody></table>';
                summaryContainer.innerHTML = tableHTML;
            }

            function processAndStoreResults(predictions, modelName, threshold) {
                const counts = {};
                for (const key in TARGET_CLASSES) counts[key] = 0;
                
                predictions.forEach(p => {
                    if (TARGET_CLASSES[p.class]) {
                        counts[p.class]++;
                    }
                });
                comparisonResults.push({ modelName, threshold, counts });
                updateComparisonTable();
            }

            async function loadModel() {
                if (model) model.dispose();
                
                currentModelName = modelSelector.value;
                statusText.textContent = `Memuat model ${currentModelName}...`;
                [startButton, predictButton].forEach(b => b.disabled = true);

                try {
                    if (currentModelName.includes('coco_ssd')) {
                        const base = currentModelName === 'coco_ssd_lite' ? 'lite_mobilenet_v2' : 'mobilenet_v2';
                        model = await cocoSsd.load({ base });
                    }
                    statusText.textContent = `Model ${currentModelName} siap.`;
                    [startButton, predictButton].forEach(b => b.disabled = false);
                } catch (error) {
                    console.error("Gagal memuat model: ", error);
                    statusText.textContent = `Error: Gagal memuat model.`;
                }
            }
            
            function stopWebcamStream() {
                if (videoStream) videoStream.getTracks().forEach(track => track.stop());
            }

            async function startWebcam() {
                stopWebcamStream();
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ 'video': { facingMode: currentFacingMode } });
                        videoStream = stream;
                        video.srcObject = stream;
                        video.addEventListener('loadeddata', predictWebcamLoop);
                    } catch (error) {
                        alert(`Tidak bisa mengakses kamera (${currentFacingMode}).`);
                    }
                }
            }

            async function predictWebcamLoop() {
                if (!videoStream || !model) return;
                canvasWebcam.width = video.videoWidth;
                canvasWebcam.height = video.videoHeight;
                const threshold = parseFloat(thresholdInput.value) || 0.4;
                const predictions = await model.detect(video, undefined, threshold);
                drawPredictions(predictions, ctxWebcam, canvasWebcam);

                const counts = {};
                predictions.forEach(p => {
                    if (TARGET_CLASSES[p.class]) {
                        counts[TARGET_CLASSES[p.class]] = (counts[TARGET_CLASSES[p.class]] || 0) + 1;
                    }
                });
                const summaryText = Object.entries(counts)
                                        .map(([key, value]) => `${value} ${key}`)
                                        .join(', ');
                webcamSummary.textContent = summaryText ? `Terdeteksi: ${summaryText}` : '';

                requestAnimationFrame(predictWebcamLoop);
            }
            
            imageUploader.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                        imagePreview.onload = () => ctxImage.clearRect(0, 0, canvasImage.width, canvasImage.height);
                    };
                    reader.readAsDataURL(file);
                }
            });

            async function predictUploadedImage() {
                if (!imagePreview.src || imagePreview.classList.contains('hidden')) return alert("Unggah gambar dulu.");
                if (!model) return alert("Model belum dimuat.");
                
                statusText.textContent = `Mendeteksi dengan ${currentModelName}...`;
                canvasImage.width = imagePreview.width;
                canvasImage.height = imagePreview.height;
                const threshold = parseFloat(thresholdInput.value) || 0.4;
                const predictions = await model.detect(imagePreview, undefined, threshold);
                
                drawPredictions(predictions, ctxImage, canvasImage);
                processAndStoreResults(predictions, currentModelName, threshold);
                statusText.textContent = "Deteksi selesai.";
            }
            
            function imageToBase64(imgElement) {
                const canvas = document.createElement('canvas');
                canvas.width = imgElement.naturalWidth;
                canvas.height = imgElement.naturalHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(imgElement, 0, 0);
                return canvas.toDataURL('image/jpeg').split(',')[1];
            }

            async function analyzeWithGemini() {
                const apiKey = apiKeyInput.value;
                if (!apiKey) return alert("Masukkan Gemini API Key.");
                if (!imagePreview.src || imagePreview.classList.contains('hidden')) return alert("Unggah gambar dulu.");

                statusText.textContent = "Menganalisis dengan Gemini AI...";
                geminiButton.disabled = true;

                try {
                    const base64ImageData = imageToBase64(imagePreview);
                    const prompt = `Analisis gambar ini. Identifikasi dan hitung jumlah objek berikut: 'person', 'bicycle', 'motorcycle', 'car', 'bus', 'truck'. Berikan hasilnya HANYA dalam format JSON yang valid. Contoh: {"person": 5, "bicycle": 2, "motorcycle": 0, "car": 10, "bus": 1, "truck": 0}`;
                    const payload = {contents: [{parts: [{ text: prompt },{ inlineData: { mimeType: "image/jpeg", data: base64ImageData } }]}]};
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload)});
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const result = await response.json();
                    const textResponse = result.candidates[0].content.parts[0].text;
                    const jsonString = textResponse.replace(/```json\n|```/g, '').trim();
                    const geminiCounts = JSON.parse(jsonString);

                    comparisonResults = comparisonResults.filter(r => r.modelName !== 'Gemini');
                    comparisonResults.push({ modelName: 'Gemini', threshold: 'N/A', counts: geminiCounts });
                    updateComparisonTable();
                    statusText.textContent = "Analisis AI selesai.";
                } catch (error) {
                    console.error("Error saat menganalisis dengan Gemini:", error);
                    statusText.textContent = "Gagal menganalisis dengan AI.";
                    alert("Terjadi kesalahan saat menghubungi API Gemini. Pastikan API Key valid.");
                } finally {
                    geminiButton.disabled = false;
                }
            }

            // Event Listeners
            modelSelector.addEventListener('change', loadModel);
            startButton.addEventListener('click', () => {
                startWebcam();
                startButton.textContent = "Deteksi Aktif...";
                startButton.disabled = true;
                switchCameraButton.classList.remove('hidden');
            });
            switchCameraButton.addEventListener('click', () => {
                currentFacingMode = (currentFacingMode === 'user') ? 'environment' : 'user';
                startWebcam();
            });
            predictButton.addEventListener('click', predictUploadedImage);
            geminiButton.addEventListener('click', analyzeWithGemini);
            resetButton.addEventListener('click', () => {
                comparisonResults = [];
                updateComparisonTable();
            });
            tabWebcam.addEventListener('click', () => {
                webcamSection.classList.remove('hidden');
                uploadSection.classList.add('hidden');
                tabWebcam.classList.add('active');
                tabUpload.classList.remove('active');
            });
            tabUpload.addEventListener('click', () => {
                webcamSection.classList.add('hidden');
                uploadSection.classList.remove('hidden');
                tabWebcam.classList.remove('active');
                tabUpload.classList.add('active');
                stopWebcamStream();
                videoStream = null;
                startButton.textContent = "Mulai Deteksi";
                startButton.disabled = false;
                switchCameraButton.classList.add('hidden');
            });
            
            function showModal(modalElement) { modalElement.classList.remove('hidden'); }
            function hideModal(modalElement) { modalElement.classList.add('hidden'); }

            apiHelpButton.addEventListener('click', () => showModal(apiHelpModal));
            modelHelpButton.addEventListener('click', () => showModal(modelHelpModal));
            thresholdHelpButton.addEventListener('click', () => showModal(thresholdHelpModal));
            closeButtons.forEach(button => button.addEventListener('click', (e) => hideModal(e.target.closest('.fixed'))));
            window.addEventListener('click', (event) => { if (event.target.classList.contains('fixed')) hideModal(event.target); });

            loadModel();
            updateComparisonTable();
        });
    </script>
</body>
</html>
